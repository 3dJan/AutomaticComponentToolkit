#=============================================================================
# The CMakeLists for the libNumbers project.
#
# This is supposed to be maintained by hand and not get generated 
# automatically like other CMakeLists
#
# ----------------------------------------------------------------------------
# Copyright 2018 Autodesk, Inc.  All rights reserved.
#
# This computer source code and related instructions and comments are the
# unpublished confidential and proprietary information of Autodesk, Inc. and
# are protected under applicable copyright and trade secret law.  They may not
# be disclosed to, copied or used by any third party without the prior
# written consent of Autodesk, Inc.
# ----------------------------------------------------------------------------

#=============================================================================

cmake_minimum_required(VERSION 3.11)

project(libNumbers)

set(CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED ${CMAKE_CURRENT_SOURCE_DIR}/Autogenerated)
if (FALSE)
### The API generation target
if (WIN32)
	set(ACT_COMMANDENDING bat)
elseif (UNIX)
	set(ACT_COMMANDENDING sh)
endif ()
add_custom_command(
    OUTPUT
		${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Bindings/Cpp/libnumbers.cpp
		${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Source/Implementation/libnumbers_interfaceexception.cpp
		${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Source/Implementation/libnumbers_interfacewrapper.cpp
    DEPENDS
        ${CMAKE_CURRENT_SOURCE_DIR}/AutomaticComponentToolkit/libnumbers.xml
    WORKING_DIRECTORY
        ${CMAKE_CURRENT_SOURCE_DIR}/AutomaticComponentToolkit
    COMMAND
        ${CMAKE_CURRENT_SOURCE_DIR}/AutomaticComponentToolkit/automaticcomponenttoolkit.${ACT_COMMANDENDING} ${CMAKE_CURRENT_SOURCE_DIR}/AutomaticComponentToolkit/libnumbers.xml ${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}
    COMMENT
        "Generating hourglass API bindings and implementation stub"
	VERBATIM
    )
add_custom_target(libnumbersACT DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/AutomaticComponentToolkit/libnumbers.xml)

endif()

### The hourglass API of the libnumbers
file(GLOB LIBNUMBERS_SRC
	"Source/Custom/*.cpp"
	"Source/Additional/*.cpp"
)
set(LIBNUMBERS_SRC ${LIBNUMBERS_SRC}
	"${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Source/Implementation/libnumbers_interfaceexception.cpp"
	"${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Source/Implementation/libnumbers_interfacejournal.cpp"
	"${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Source/Implementation/libnumbers_interfacewrapper.cpp")

add_library(libnumbers SHARED ${LIBNUMBERS_SRC})
target_compile_options(libnumbers PRIVATE "-D__LIBNUMBERS_DLL")
target_include_directories(libnumbers PRIVATE ${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Source/Implementation)
target_include_directories(libnumbers PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/Source/Stub)
	
# add_dependencies(libnumbers libnumbersACT)

### The test application for the Machining component
option(USECPPSTATICAPI "Should the test application for libnumbers use the dynamic or static C++-bindings?"
       ON)
file(GLOB MACHININGTEST_SRC
	"libnumbersTest/main.cpp"
)
if(${USECPPSTATICAPI})
	set(MACHININGTEST_SRC ${MACHININGTEST_SRC} "${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Bindings/Cpp/libnumbers.cpp")
endif()

add_executable(libnumbersTest ${MACHININGTEST_SRC})
target_link_libraries(libnumbersTest libnumbers)
if(${USECPPSTATICAPI})
	target_include_directories(libnumbersTest PUBLIC ${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Bindings/Cpp)
else()
	target_include_directories(libnumbersTest PUBLIC ${CMAKE_CURRENT_BINARY_DIR_AUTOGENERATED}/Bindings/CppDynamic)
	target_compile_options(libnumbersTest PRIVATE "-DLIBNUMBERSUSECPPDYNAMIC")
endif()
